%---------------------------------------------------------------------
%
%                          Capítulo 3
%
%---------------------------------------------------------------------

\chapter{Tecnologías empleadas}
\label{cap4:sec:kinect}

En este capítulo se presentan las tecnologías y dispositivos empleadas para el desarrollo del proyecto. Detallando de forma técnica el \textit{software} y \textit{hardware} utilizado para realizarlo.


%-------------------------------------------------------------------
\section{Software empleado}
%-------------------------------------------------------------------
\label{cap4:sec:Software empleados}
El software principal utilizado en este proyecto es \texttt{Unity 5.5} \citep{Unity_Manual}, ya que se trata de un motor para el desarrollo de videojuegos muy versátil. Con el fin de elaborar, compilar y depurar el proyecto de \texttt{Unity} se ha utilizado \texttt{Visual Studio 2015} \citep{VSMS}  y \texttt{MonoDevelop} \citep{Monodevelop} con el lenguaje de programación C\#, ya que mantienen una sola base de código para todas las plataformas. Respecto a la creación de los personajes, previamente se utilizó la aplicación \texttt{MakeHuman} \citep{MakeHuman}, pero se observó que \texttt{Fuse Character Creator de Mixamo} \citep{FuseCharCreaMixamo} ofrecía una  creación de modelos humanos mas estéticos. En cuanto a las animaciones, se hizo uso de \texttt{Mixamo 3D Animation Online Services} \citep{Mixamo3DAnimation}, ya que es una compañía tecnológica encargada del desarrollo y venta de servicios para la animación de personajes 3D. A través de \texttt{Marvelous Designer} \citep{MarvelousDesigner} se probó la confección de la ropa que utilizarían los avatares, pero se opto por utilizar los diseños predefinidos de \texttt{Fuse Character Creator de Mixamo} debido a la alta calidad de las texturas.

\subsection{Entorno de desarrollo : Unity 3D}
%-------------------------------------------------------------------
\label{cap4:sec:Entorno de desarrollo : Unity 3D}
El objetivo de este proyecto es la captura y el análisis de movimiento relacionados con el arte marcial afro-brasileño capoeira. Con esto en mente, se llega a la primera decisión de que plataforma escoger para el desarrollo de este proyecto.
\vspace{0.4cm}
Los entornos a elegir para la creación de escenarios 3D fueron: \texttt{Visual Studio 2015} \citep{VSMS}, \texttt{Unity 3D Engine} \citep{Unity} y \texttt{Unreal Engine} \citep{Unreal}. El primero descartado fue \texttt{Visual Studio 2015}, ya que se busca el desarrollo de escenarios 3D de una manera mas intuitiva y, tanto \texttt{Unity} como \texttt{Unreal}, ofrecen herramientas mas útiles para la creación de estos escenarios.

En cuanto a la decisión de elegir entre \texttt{Unity} o \texttt{Unreal Engine} fue basada en la comunidad que hay detrás de cada uno de ellos, y sobre todo, en lo que se quiere abarcar con este proyecto. \texttt{Unreal} suele ser utilizado por las empresas para juegos grandes y mas profesionales, mientras que \texttt{Unity} se puede aplicar, tanto a pequeñas como a grandes aplicaciones, siendo su aprendizaje de este mas intuitivo que \texttt{Unreal}.

Un motor de juegos se especifica como la rutina de programación que permiten el diseño, la creación y la representación de un videojuego. En este caso, se adecua correctamente ya que se pretende realizar un entorno 3D donde los usuarios se perciban y aprendan movimientos controlando un avatar.

La funcionalidad de un motor de juegos consiste en proveer al juego de un motor de renderizado para los gráficos 2D y 3D,  motor físico, sonidos, scripting, animación, un escenario gráfico, etc..\\

\texttt{Unity} es un motor de juegos desarrollado por la  compañía \texttt{Unity Technologies} y utiliza los lenguajes de programación C ,C++ , C\# y javascript.


\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth]{Imagenes/Capitulos/4/logo_unity}
	\caption{Logo Unity}
	\label{fig:logo_Unity}
\end{figure}


En un primer momento \texttt{Unity} salió al mercado ofreciendo un software de calidad y barato añadiendo el objetivo de que pequeñas y grandes empresas pudieran utilizarlo por igual, dando además, la posibilidad de que su contenido sea compatible con prácticamente cualquier medio o dispositivo\citep{Unity-relations}. Gracias a ello, \texttt{Unity} creció exponencialmente en el mercado, generando así, una gran comunidad que puede servir de pilar de ayuda para los nuevos desarrolladores.

\texttt{Unity} ofrece diferentes tipos de versiones como la personal, que es gratuita y la profesional, que es de pago. En la versión personal es necesario promocionar el logotipo de \texttt{Unity} y también carece de funcionalidades adicionales de renderizado del motor que la profesional si contiene.

Otro aspecto importante de \texttt{Unity} es el \texttt{Asset Store}. Es una biblioteca del editor que contiene una multitud de paquetes o \textit{Assets} comerciales y gratuitos creados, de forma continua, por la comunidad o por \texttt{Unity Technologies}. Estos paquetes pueden contener modelados 3D, texturas, animaciones y demás de contenido que servirá de ayuda al proyecto al no poder contar con un experto diseñador. 

La apariencia del editor de \texttt{Unity} se observa en la figura \ref{fig:editor_Unity}

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.92\linewidth]{Imagenes/Capitulos/4/editor-unity}
	\caption{Apariencia de editor Unity}
	\label{fig:editor_Unity}
\end{figure}

Como se observa en la imagen, el editor de \texttt{Unity} esta formado por varios paneles. Cabe destacar que la estructuración básica de un juego de \texttt{Unity} se realiza mediante escenas y para poder tener una previsualizanción de los elementos que aparecen en una escena se utiliza el panel uno denominado \textit{scene}. Este panel representa una dimensión 3D donde se podrá rotar y desplazar en los tres ejes ,para conseguir de esta manera, modificar todos los elementos de la escena en cualquier ángulo.

El segundo panel denominado \textit{Game} muestra la vista generada por la cámara, es decir, la imagen que se verá en el juego.

Los elementos incorporados a la escena se archivan en el panel tercero con el nombre \textit{Hierarchy}. Estos pueden ser  objetos 3D, cámara, sonidos, luces, e incluso objetos de tipo GUI(Interfaz gráfica de usuario) para la implemetación de interfaces. Los elementos se muestran de una forma jerárquica y al seleccionar uno se expondrán sus características y componentes en el panel cuarto denominado \textit{Inspector}. Por ejemplo, al seleccionar la cámara en el \textit{Hierarchy} muestra su componente \textit{transform}, este muestra la información de su posición y rotación, pudiendo ser modificable.

El panel quinto llamado \textit{Project} agrupa ,en forma de directorio, todos los \textit{scripts} , paquetes , imágenes y archivos relacionados con el proyecto.
\vspace{0.7cm}

La ejecución de pruebas del juego se realiza por medio del \textit{Play mode} situado en el panel sexto. Esta funcionalidad permite poner en funcionamiento el juego , pararlo y detener su ejecución, siendo esto, fundamental para comprobar y depurar un juego \citep{Unity_Manual}.

Una vez estudiado el editor de \texttt{Unity} se toma la decisión de que lenguaje de programación utilizar. \texttt{Unity }soporta dos lenguajes:
\begin{itemize}
	\item C\#: lenguaje estandar similar a C++ y \texttt{Java}.
 	\item \textit{UnityScript} : lenguaje basado en \texttt{javascript} propio de \texttt{Unity}.  
\end{itemize} 
Se optó por la decisión de utilizar C\# porque se acomoda mejor a la aplicación, puesto que no está orientada a web, y además ofrece unas características mejores que el \textit{UnityScript}.

Para controlar los eventos de un objeto o los eventos de las entradas de los usuario, \texttt{Unity} utiliza \textit{scripts}. De forma básica los \textit{scripts} tienen implementado un método \textit{Start} para inicializar las variables del objeto y un método \textit{Update} encargado de actualizar los parámetros a partir del tratamiento de eventos.

Se utilizó \texttt{Visual Studio 2015} \citep{VSMS} para la depuración de \textit{scripts}, ya que proporciona visualización de las variables utilizadas en tiempo de ejecución, y además, da la posibilidad de ejecutar el \textit{script} paso a paso. También otro factor clave fue que con este entorno de programación se tenía experiencia previa de uso.

El otro programa utilizado para la depuración de \textit{scripts} en \texttt{Unity} fue \texttt{MonoDevelop}, ya que proporciona un entorno de desarrollo libre y gratuito, diseñado primordialmente para C\#.

\subsection{MakeHuman}

La aplicación MakeHuman sirve para crear modelos humanos que pueden ser utilizados en diferentes plataformas 3D, como animaciones, videojuegos, etc. Promueve el arte digital y artistas digitales, proporcionando una herramienta de alta calidad liberada al dominio público con la licencia CCO, mientras que la base de datos y el código se publicaron mediante una licencia AGPL3.

%\begin{figure}[h!]
%	\centering
%	\includegraphics[width=0.8\linewidth, height=0.3\textheight]{Imagenes/Capitulos/4/logo_makehuman}
%	\caption{Logo MakeHuman}
%	\label{fig:logo_makehuman}
%\end{figure}


MakeHuman utiliza un humano estándar y mediante varios deslizadores o scrolls se podrán alterar los parámetros de la estatura, anchura, sexo, edad, etc. (véase Figura \ref{fig:makehuman_estandar})


\begin{figure}[h!]
	\centering
	\includegraphics[width=0.8\linewidth, height=0.3\textheight]{Imagenes/Capitulos/4/makehuman_estandar}
	\caption{Aspecto del humano estándar de MakeHuman}
	\label{fig:makehuman_estandar}
\end{figure}

En un principio se pensó utilizar esta aplicación para el modelado de los personajes debido a su intuitiva interfaz y la facilidad de exportación en formato fbx el cual utiliza Unity. Pero tras investigar posibles alternativas, se encontró la aplicación Fuse Character Creator, la cual posibilitaba el desarrollo de los personajes con mayor calidad. De forma simultanea se podría realizar la configuración de los personajes para su posterior animación.

\subsection{Fuse Character Creator}

Se trata de una aplicación desarrollada por Mixamo, la cual permite crear personajes 3D únicos mediante una intuitiva interfaz que separa el avatar en diferentes partes, como son la cabeza, el torso, las piernas y los brazos (véase Figura \ref{fig:fuse}). Posteriormente a la selección de las diferentes partes del cuerpo ya predefinidas por el sistema, se puede editar cada una de las partes del personaje, ya sean los rasgos de la cara, el tamaño de los brazos, la longitud de las piernas, etc. Al seleccionar la parte del cuerpo que se quiere modificar, simplemente será necesario pinchar y realizar un \textit{scrool} o deslizamiento hacia la izquierda o derecha para aumentar su tamaño. Por otro lado, para seleccionar el punto exacto donde se ubicarán las diferentes parte del cuerpo como por ejemplo el ombligo, los ojos, las rodillas, etc, se realizará un \textit{scrool} o desplazamiento hacía arriba o abajo.

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.92\linewidth, height=0.36\textheight]{Imagenes/Capitulos/4/Fuse}
	\caption{Humano básico de Fuse Character Creator}
	\label{fig:fuse}
\end{figure}


Al terminar de modelar el personaje, se pasará a la sección de vestuario. Donde existen prendas predefinidas, como camisas, pantalones, zapatos, etc. Al terminar de vestir al avatar, esta aplicación posee la peculiaridad de poder subir al servidor de Mixamo el modelado realizado. Pudiendo completar la configuración de los huesos (\textit{rigger}), con la posibilidad de crear varios esqueletos para un mismo personaje y además incluir las animación deseadas.

Para la utilización de esta aplicación es necesario el uso del servidor Steam\footnote{http://store.steampowered.com/?l=spanish}, ya que se trata de una plataforma de distribución digital, comunicaciones y servicios multijugador, donde está alojado \textit{Fuse Character Creator}.


\subsection{Mixamo 3D Animation Online Services}

Mixamo\footnote{https://www.mixamo.com/} es una compañía tecnológica encargada del desarrollo y venta de servicios para la animación de personajes 3D. Proporcionanando un servicio \textit{online} que permite buscar entre una amplia gama de movimientos, que van desde el combate, pasando por deportes, hasta poder tocar un instrumento. 

Los productos y características de Mixamo son compatibles con todos los paquetes de software 3D, pudiendo realizar una exportación eligiendo entre varias aplicaciones 3D como: Unity3d, UDK, 3ds Max, Maya, Motionbuilder, zBrush, Houdini entre otros.


Una de las características más sorprendentes de Mixamo es el \textit{Auto-Rigger}. Ya que ahorras horas de trabajo modelando el personaje y con este sistema el proceso sucede en cuestión de minutos. Todo lo que se necesita hacer es subir al servidor de Mixamo el personaje 3D (soporta .fbx, .bvh, .zip, obj), seleccionar el numero de huesos que mejor se adapte al esqueleto del personaje (véase Figura \ref{fig:mixamo-rig}) y esperar que termine el proceso de \textit{rigger}.

Tras completar la fase de modelado, Mixamo ofrece la posibilidad de animar al personaje con movimientos, que permiten, no sólo aplicar cualquier animación, sino también personalizarlas, ya que se pueden modificar en tiempo real con el personaje obteniendo el resultado deseado. (véase Figura \ref{fig:mixamo}) Por último descargarlos en cualquier formato que necesita (.fbx, .bvh, .dae) y fácilmente combinar de nuevo en sus escenas en 3D
\vspace{0.4cm}

Estas animaciones utilizan una base matemática, lo que facilita su uso para los diferentes personajes que se deseen animar. Tradicionalmente era extremadamente lento, costoso y complicado, lograr modelar personajes 3D con resultados de alta calidad. En cambio mediante esta técnica, Mixamo intenta reducir los tiempos de desarrollo, pudiendo obtener unas animaciones de calidad, sin la necesidad de contar con altos recursos. 

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.98\linewidth, height=0.4\textheight]{Imagenes/Capitulos/4/Mixamo}
	\caption{Servicio \textit{online} con animaciones de Mixamo}
	\label{fig:mixamo}
\end{figure}


\section{Hardware empleado}
\label{cap4:sec:hardware empleado}
Sin embargo, el desarrollo del proyecto se llevó a cabo en ordenadores portátiles
personales sin grandes especificaciones técnicas más allá del soporte gráfico para la RV

El hardware principal usado en este proyecto es el dispositivo de captura de movimiento \texttt{Kinect versión 2} \citep{Kinectv2} y el adaptador de \texttt{Kinect} para conectar el sensor al sistema operativo Windows \citep{adaptadorKinect}. Sin embargo, el desarrollo del proyecto se llevó a cabo en ordenadores portátiles personales, teniendo que utilizar uno de ellos como enlace con \texttt{Kinect}, debido a la limitación de uso que tiene el dispositivo en un solo sistema operativo, como es Windows.

\subsection{Kinect versión 2}


Se trata de un periférico que permite a los usuarios interactuar con la aplicación, de modo que gracias a sus sensores, no tiene la necesidad de utilizar algún tipo de mando inalámbrico. Este dispositivo se documenta en la sección \ref{Kinect} del proyecto.

Pasados unos años tras la salida de \texttt{Kinect}, en 2014 Microsoft liberó el controlador \textit{Software Development Kit (SDK)} para entornos Windows de forma gratuita, con el objetivo de sacarle un mayor rendimiento a esta tecnología. De modo que, facilitó su uso en múltiples aplicaciones, como en el caso de la captura de movimientos. 

Por lo tanto, para el uso de \texttt{Kinect} en un equipo o \textit{tablet} con un sistema operativo Windows \citep{KinectdeWindows}, deberá cumplir unos requisitos mínimos \textit{hardware y software}:

\begin{itemize}
	\item{Procesador de 64 bits (x64).}
	\item{Doble núcleo físico de 3,1 GHz.}
	\item{Controlador USB 3.0  (versión 2.2.1610.17001 o superior)}
	\item{Adaptador de \texttt{Kinect} para conectar el sensor al sistema operativo Windows.}
	\item{4 GB de RAM.}
	\item{Tarjeta gráfica que admita DirectX 11.}
	\item{Windows 8 u 8.1, Windows Embedded 8 o Windows 10.}
\end{itemize} 

Microsoft aporta una herramienta\footnote{http://go.microsoft.com/fwlink/p/
	?LinkID=513889} para verificar que el PC o la \textit{tablet} cumplen con los requisitos de compatibilidad y para comprobar el sistema en busca de cualquier problema conocido. Además, asegurándose de estar utilizando el controlador mas reciente para la GPU. (véase Figura \ref{fig:verificador_kinect})

\begin{figure}[h!]
	\centering
	\includegraphics[width=0.7\linewidth, height=0.5\textheight]{Imagenes/Capitulos/4/verificador_kinect}
	\caption{Herramienta verificadora de \texttt{Kinect} }
	\label{fig:verificador_kinect}
\end{figure}

\vspace{0.3cm}

Para el correcto funcionamiento de \texttt{Kinect}, será necesario instalar varios \textit{softwares} añadidos:

\begin{itemize}
	\item SDK (versión 11)\footnote{https://www.microsoft.com/en-us/download/details.aspx?id=44561}
	
	\item \textit{Speech Platform Runtime} (versión 11)\footnote{https://www.microsoft.com/en-us/download/details.aspx?id=27225}
	
	\item \textit{DirectX Software Development} Kit\footnote{https://www.microsoft.com/en-us/download/details.aspx?id=6812}
	
\end{itemize}

Debido a los problemas ocasionados con algunos equipos utilizados, se deberá comprobar previamente que el adaptador \textit{host} USB 3.0 es compatible con \texttt{Kinect}, ya que no todas las versiones del controlador proporcionan el ancho de banda del USB requerido por el sensor. Se deberá tener en cuenta, que se puede necesitar probar diferentes ranuras PCI-e para encontrar un controlador que se adapte a las necesidades del dispositivo \texttt{Kinect}.


\subsection{Adaptador de Kinect para Windows}

Conecta el sensor \texttt{Kinect} para Xbox One al ordenador o tableta mediante el adaptador \texttt{Kinect} para Windows (véase Figura \ref{fig:adaptadorkinect2}) y de ese modo, poder desarrollar soluciones personalizadas para diferentes aplicaciones. 


\begin{figure}[h!]
	\centering
	\includegraphics[width=0.9\linewidth, height=0.3\textheight]{Imagenes/Capitulos/4/adaptador_kinect2}
	\caption{Adaptador de \texttt{Kinect} para Windows}
	\label{fig:adaptadorkinect2}
\end{figure}


\subsection{Equipo para el uso de Kinect}

Este equipo no posee una características muy especiales, mas allá de utilizar el sistema operativo Windows. De modo que será el PC utilizado para conectar \texttt{Kinect}, obteniendo un correcto funcionamiento.
\vspace{0.3cm}

Teniendo las siguientes especificaciones técnicas:

\begin{itemize}
	\item Procesador: Intel® Core i5-4210U (1.7 GHz)
	\item Memoria RAM: 8GB DDR3L SODIMM PC3-12800 1600Mhz
	\item Disco duro: 500GB (5400 rpm S-ATA)
	\item Display: 15.6" LED Full HD (1920x1080) 
	\item Controlador gráfico: Nvidia GeForce 820M 2GB DDR3
	\item Conexiones: 1 USB 3.0 (versión 2.2.1610.17001) , 2 x USB 2.0, 1 HDMI
\end{itemize}

%Y tambi?n ponemos el acr?nimo \ac{CVS} para que no cruja.

%Ten en cuenta que si no quieres acr?nimos (o no quieres que te falle la compilaci?n en ``release'' mientras no tengas ninguno) basta con que no definas la constante \verb+\acronimosEnRelease+ (en \texttt{config.tex}).


%-------------------------------------------------------------------
%\section*{\ProximoCapitulo}
%-------------------------------------------------------------------



% Variable local para emacs, para  que encuentre el fichero maestro de
% compilaci?n y funcionen mejor algunas teclas r?pidas de AucTeX
%%%
%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../Tesis.tex"
%%% End:
