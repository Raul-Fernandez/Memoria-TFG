%---------------------------------------------------------------------
%
%                          Capítulo 7
%
%---------------------------------------------------------------------

\chapter{Distribución de trabajo}

En el presente TFG la distribución de trabajo por parte de los miembros del equipo de desarrollo ha sido bastante ecuánime.

  
En una primera instancia fue necesario realizar una investigación conjunta sobre el campo de trabajo. El cual comprende el uso de la informática y nuevas tecnologías aplicadas a la captura de movimiento, que al ser un tema totalmente novedoso para los desarrolladores, implicó un estudio del estado del arte actual.  


Debido a las características del trabajo y los dispositivos necesarios para su desarrollo, al contar con recursos limitados, es decir, con únicamente una \texttt{Kinect} y un equipo compatible con las características de la misma, resultaba complicado el desarrollo en paralelo. Por ello se adoptó la política de establecer reuniones diarias, en las que se trabajaba de manera intensiva en tareas conjuntas que permitieran la integración en el sistema de los dispositivos mencionados. Estas reuniones  tuvieron lugar en la Facultad de Informática de la Universidad Complutense de Madrid, específicamente en la biblioteca de este centro.

El objetivo general del proyecto era el desarrollo de un entrenador personal virtual basado en el arte marcial afro-brasileño capoeira. Para ello, la intención consistía en mostrar, mediante un escenario 3D, el entrenamiento realizado por un usuario para el aprendizaje de capoeira, siendo necesario exponer los movimientos del entrenador virtual con el fin de ser imitando. Inicialmente, se desconocía como se iba a llevar a cabo este objetivo global y abstracto, ya que requería la comprensión profunda del dispositivo \texttt{Kinect} y sus posibilidades. Uno de los aspectos más importantes del proyecto ha sido todo lo relacionado con la captura de movimientos. Debido a los problemas de conectividad de \texttt{Kinect} con los ordenadores y que al final solo funcionaba en un equipo, se decidió de manera conjunta, estudiar y extraer los datos transmitidos por el sensor de \texttt{kinect}.

Tras un breve periodo inicial de aprendizaje en Unity ambos desarrolladores contaban con los conocimientos necesarios para abordar el escenario 3D. Una vez entendido el funcionamiento de la simulación del \textit{cubeman}, de forma conjunta, se investigó la manera de guardar la información de la captura de movimiento, empleando así, un fichero de texto como registro de cada articulación del \textit{cubeman}. Los datos se archivan guardando la identificación del \textit{cubeman} y cada una de las coordenadas(X,Y,Z)  asociadas a las articulaciones. Gracias a la investigación anterior, se implementó la forma de reproducir los movimiento pregrabados, realizados por los desarrolladores, a la vez que simulaba el movimiento en tiempo real de un usuario. Esto consiste en generar los datos del \textit{BodyData} registrados en el \textit{SensorData} de diferentes fuentes. La primera son datos obtenidos a partir de la cámara de \textit{kinect} y la segunda genera el \textit{BodyData} con el fichero de texto. Aunque antes de añadir la segunda fuente, se busca un espacio libre en el \textit{SensorData} de \texttt{Kinect} para no pisar el \textit{BodyData} del usuario que está captando la cámara, y de esta manera, mostrar los dos \textit{cubeman} a la vez.

Llegados a este punto, se debatió entre varias ideas para  desempeñar una de las funcionalidades del entrenador virtual, la comparación del movimiento. El planteamiento ganador consistió en crear un gesto para la comparación del movimiento, este a su vez, desempeña un comportamiento de máquina de estados, sirviendo el primer estado para calibrar la posición inicial del movimiento y los siguientes estados se encargan de la comparación del movimiento a superar. 
Esta contribución se realizó por los dos miembros del grupo de forma equitativa.

A partir de esta etapa del desarrollo se pudo realizar cierto reparto de tareas, pero siempre atado a las limitaciones de tener un único dispositivo \texttt{Kinect}.\\

El integrante del grupo \texttt{Víctor}, contribuyó a conectar los huesos de los avatares con la información de los \textit{Joints} ofrecidos por el \textit{Sensordata}, de esta manera, los avatares son animados por los movimientos de los usuarios. Después acopló tres animaciones a los avatares, siendo la primera el movimiento de la \textit{ginga} que se activa cuando no se detecta al usuario, ofreciendo así, un aspecto mas dinámico al avatar. Las dos animaciones siguientes son la pose de victoria y derrota, que son incorporadas para dar un \textit{feedback} visual al usuario en respuesta del movimiento realizado. Después, se observó un conflicto generado por el componente de \texttt{animator} y el componente que conectaba el avatar con \texttt{Kinect}, haciendo imposible el control del avatar cuando los dos componentes estaban activos. Por ese motivo, desarrolló un método que desactiva por completo el componente \texttt{animator} cuando no se detectaba un usuario, haciendo solo que el controlador de \texttt{Kinect} asumiera pleno control sobre el avatar.


Siguiendo con la contribución de Víctor, implementó la forma de mostrar el análisis del movimiento comparado anteriormente. Para lograr esta funcionalidad, registró el movimiento del usuario y el del experto hasta el momento que comete el error, de esta manera, se tiene la información de la posición de cada uno de los \texttt{Joints} perteneciente a los dos avatares. A continuación, modificó el aspecto de los avatares para hacerlos transparentes y generar un esqueleto verde, simulando de este modo las partes del cuerpo. A partir de este estado, los avatares reproducen el movimiento registrado hasta el momento que el usuario falla, coloreando de  rojo los huesos o partes del cuerpo donde el usuario a errado. Adicionalmente se incorporó un panel indicando las medidas que debe tomar para la corrección de las partes del cuerpo erradas.\\


Paralelamente el otro integrante del grupo Raúl implementó o diseño,
\comImpl{aki tu mierda raul}

Aunque se repartieron las tareas era necesario seguir la política de reuniones constantes para compactar las partes y comprobar su correcto funcionamiento.

Posteriormente, después de conexionar las tareas anteriores, cada desarrollador diseña un escenario para colocar a los diferentes avatares que aparecen en el proyecto, y de esta manera, poder diferencia la característica que les identifica.

Por ultimo, con la actuación de ambos componentes del grupo, se hicieron grabaciones con la gente experta de la escuela Abadá-Capoeira. Las grabaciones tuvieron una duración de dos días, y gracias a esto, se obtuvieron todas las muestras posibles que la tecnología de captura de movimiento de \texttt{Kinect} permitió grabar de una manera aceptable. Después se ajustaron y catalogaron los movimientos para poder incorporarlos al proyecto.






